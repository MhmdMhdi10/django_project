/* This example requires Tailwind CSS v2.0+ */
import {Fragment, useEffect, useState} from 'react'
import {Menu, Popover, Transition} from '@headlessui/react'
import {NavLink, Link} from 'react-router-dom'
import {Navigate} from 'react-router-dom'
import Alert from '../../components/alert'

import {
    BookmarkAltIcon,
    BriefcaseIcon,
    ChartBarIcon,
    CheckCircleIcon,
    CursorClickIcon,
    DesktopComputerIcon,
    GlobeAltIcon,
    InformationCircleIcon,
    MenuIcon,
    NewspaperIcon,
    OfficeBuildingIcon,
    PhoneIcon,
    PlayIcon,
    ShieldCheckIcon,
    UserGroupIcon,
    ViewGridIcon,
    XIcon,
} from '@heroicons/react/outline'
import {connect} from 'react-redux'
import {logout} from '../../redux/actions/auth'
import {get_categories} from '../../redux/actions/categories'
import {get_search_products} from '../../redux/actions/products';
import SearchBox from './SearchBox'
import {ShoppingCartIcon} from '@heroicons/react/solid'
import pc from '../../img/pc-tower.png';


// const solutions = [
//     {
//         name: 'Analytics',
//         description: 'Get a better understanding of where your traffic is coming from.',
//         href: '#',
//         icon: ChartBarIcon,
//     },
//     {
//         name: 'Engagement',
//         description: 'Speak directly to your customers in a more meaningful way.',
//         href: '#',
//         icon: CursorClickIcon,
//     },
//     {name: 'Security', description: "Your customers' data will be safe and secure.", href: '#', icon: ShieldCheckIcon},
//     {
//         name: 'Integrations',
//         description: "Connect with third-party tools that you're already using.",
//         href: '#',
//         icon: ViewGridIcon,
//     },
// ]
const callsToAction = [
    {name: 'Watch Demo', href: '#', icon: PlayIcon},
    {name: 'View All Products', href: '#', icon: CheckCircleIcon},
    {name: 'Contact Sales', href: '#', icon: PhoneIcon},
]
const company = [
    {name: 'About', href: '#', icon: InformationCircleIcon},
    {name: 'Customers', href: '#', icon: OfficeBuildingIcon},
    {name: 'Press', href: '#', icon: NewspaperIcon},
    {name: 'Careers', href: '#', icon: BriefcaseIcon},
    {name: 'Privacy', href: '#', icon: ShieldCheckIcon},
]
const resources = [
    {name: 'Community', href: '#', icon: UserGroupIcon},
    {name: 'Partners', href: '#', icon: GlobeAltIcon},
    {name: 'Guides', href: '#', icon: BookmarkAltIcon},
    {name: 'Webinars', href: '#', icon: DesktopComputerIcon},
]
const blogPosts = [
    {
        id: 1,
        name: 'Boost your conversion rate',
        href: '#',
        preview: 'Eget ullamcorper ac ut vulputate fames nec mattis pellentesque elementum. Viverra tempor id mus.',
        imageUrl:
            'https://images.unsplash.com/photo-1558478551-1a378f63328e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2849&q=80',
    },
    {
        id: 2,
        name: 'How to use search engine optimization to drive traffic to your site',
        href: '#',
        preview: 'Eget ullamcorper ac ut vulputate fames nec mattis pellentesque elementum. Viverra tempor id mus.',
        imageUrl:
            'https://images.unsplash.com/photo-1486312338219-ce68d2c6f44d?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=2300&q=80',
    },
]

function classNames(...classes) {
    return classes.filter(Boolean).join(' ')
}

function Navbar({
                    isAuthenticated,
                    user,
                    logout,
                    get_categories,
                    categories,
                    get_search_products,
                    total_items,
                    profile,
                }) {

    // eslint-disable-next-line
    const [redirect, setRedirect] = useState(false);

    const [render, setRender] = useState(false);
    const [formData, setFormData] = useState({
        category_id: 0,
        search: ''
    });
    const {category_id, search} = formData;

    useEffect(() => {
        get_categories()
    }, [])

    const onChange = e => setFormData({...formData, [e.target.name]: e.target.value});

    const onSubmit = e => {
        e.preventDefault();
        console.log('aaaallllll')
        get_search_products(search, category_id);
        setRender(!render);
    }

    if (render) {
        return <Navigate to='/search'/>;
    }

    const logoutHandler = () => {
        logout()
        setRedirect(true);
    }

    if (redirect) {
        window.location.reload(false)
        return <Navigate to='/'/>;
    }

    const authLinks = (
        <Menu as="div" className="relative inline-block text-left">
            <div>
                <Menu.Button
                    className="inline-flex justify-center w-full rounded-full  text-sm font-medium text-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-indigo-500">
          <span className="inline-block h-10 w-10 rounded-full overflow-hidden bg-gray-100">
              <img src={profile && profile.image} alt=""/>
          </span>
                </Menu.Button>
            </div>

            <Transition
                as={Fragment}
                enter="transition ease-out duration-100"
                enterFrom="transform opacity-0 scale-95"
                enterTo="transform opacity-100 scale-100"
                leave="transition ease-in duration-75"
                leaveFrom="transform opacity-100 scale-100"
                leaveTo="transform opacity-0 scale-95"
            >
                <Menu.Items
                    className="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none">
                    <div className="py-1">
                        <Menu.Item>
                            {({active}) => (
                                <Link
                                    to="/dashboard"
                                    className={classNames(
                                        active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                                        'block px-4 py-2 text-sm'
                                    )}
                                >
                                    Dashboard
                                </Link>
                            )}
                        </Menu.Item>


                        <form method="POST" action="#">
                            <Menu.Item>
                                {({active}) => (
                                    <button
                                        onClick={logoutHandler}
                                        className={classNames(
                                            active ? 'bg-gray-100 text-gray-900' : 'text-gray-700',
                                            'block w-full text-left px-4 py-2 text-sm'
                                        )}
                                    >
                                        Sign out
                                    </button>
                                )}
                            </Menu.Item>
                        </form>
                    </div>
                </Menu.Items>
            </Transition>
        </Menu>
    )

    const guestLinks = (
        <Fragment>
            <Link to="/login"
                  className="ml-8 inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-base font-medium text-black">
                Sign in
            </Link>
            <Link
                to="/signup"
                className="ml-8 inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-base font-medium text-black"
            >
                Sign up
            </Link>
        </Fragment>
    )

    return (
        <>
            <Popover className="relative">
                <div className="absolute inset-0  z-30 pointer-events-none" aria-hidden="true"/>
                <div className="relative z-20">
                    <div
                        className="max-w-7xl mx-auto flex justify-between items-center px-4 py-5 sm:px-6 sm:py-4 lg:px-8 md:justify-start md:space-x-10">
                        <div>
                            <Link to="/" className="flex">
                                <span className="sr-only">Mti Pc</span>
                                <img
                                    className="h-8 w-auto sm:h-10"
                                    src={pc}
                                    alt=""
                                />
                            </Link>
                        </div>
                        <div className="-mr-2 -my-2 md:hidden">

                            <Link to="/cart"
                                  className="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                                <span className="sr-only">Open menu</span>
                                <ShoppingCartIcon className="h-6 w-6" aria-hidden="true"/>
                                <span
                                    className="text-xs absolute top-1 mt-3 ml-4 bg-red-500 text-white font-semibold rounded-full px-2 text-center">{total_items}</span>
                            </Link>
                            <Popover.Button
                                className="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                                <span className="sr-only">Open menu</span>
                                <MenuIcon className="h-6 w-6" aria-hidden="true"/>
                            </Popover.Button>
                        </div>
                        <div className="hidden md:flex-1 md:flex md:items-center md:justify-between">
                            <Popover.Group as="nav" className="flex space-x-10">

                                <NavLink to="/shop"
                                         className={window.location.pathname === '/search' ? ' text-base font-medium text-gray-500 hover:text-gray-900' : 'mt-2 text-base font-medium text-gray-500 hover:text-gray-900'}>
                                    Shop
                                </NavLink>

                                {window.location.pathname === '/search' ? <></> : <SearchBox
                                    search={search}
                                    onChange={onChange}
                                    onSubmit={onSubmit}
                                    categories={categories}
                                />}


                            </Popover.Group>
                            <div className="flex items-center md:ml-12">
                                <Link to="/cart">
                                    <ShoppingCartIcon className="h-8 w-8 cursor-pointer text-gray-300 mr-4"/>
                                    <span
                                        className="text-xs absolute top-1 mt-3 ml-4 bg-red-500 text-white font-semibold rounded-full px-2 text-center">{total_items}</span>
                                </Link>
                                {
                                    isAuthenticated ? authLinks : guestLinks
                                }
                            </div>
                        </div>
                    </div>
                </div>

                <Transition
                    as={Fragment}
                    enter="duration-200 ease-out"
                    enterFrom="opacity-0 scale-95"
                    enterTo="opacity-100 scale-100"
                    leave="duration-100 ease-in"
                    leaveFrom="opacity-100 scale-100"
                    leaveTo="opacity-0 scale-95"
                >
                    <Popover.Panel
                        focus
                        className="absolute z-30 top-0 inset-x-0 p-2 transition transform origin-top-right md:hidden"
                    >
                        <div
                            className="rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 bg-white divide-y-2 divide-gray-50">
                            <div className="pt-5 pb-6 px-5 sm:pb-8">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <img
                                            className="h-8 w-auto"
                                            src={pc}
                                            alt="Workflow"
                                        />
                                    </div>
                                    <div className="-mr-2">
                                        <Popover.Button
                                            className="bg-white rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500">
                                            <span className="sr-only">Close menu</span>
                                            <XIcon className="h-6 w-6" aria-hidden="true"/>
                                        </Popover.Button>
                                    </div>
                                </div>
                                <div className="mt-6 sm:mt-8">
                                    <nav>
                                        {/*<div className="grid gap-7 sm:grid-cols-2 sm:gap-y-8 sm:gap-x-4">*/}
                                        {/*    {solutions.map((item) => (*/}
                                        {/*        <a*/}
                                        {/*            key={item.name}*/}
                                        {/*            href={item.href}*/}
                                        {/*            className="-m-3 flex items-center p-3 rounded-lg hover:bg-gray-50"*/}
                                        {/*        >*/}
                                        {/*            <div*/}
                                        {/*                className="flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-md bg-indigo-500 text-white sm:h-12 sm:w-12">*/}
                                        {/*                <item.icon className="h-6 w-6" aria-hidden="true"/>*/}
                                        {/*            </div>*/}
                                        {/*            <div*/}
                                        {/*                className="ml-4 text-base font-medium text-gray-900">{item.name}</div>*/}
                                        {/*        </a>*/}
                                        {/*    ))}*/}
                                        {/*</div>*/}
                                        <div className="mt-8 text-base">
                                            <a href="#" className="font-medium text-indigo-600 hover:text-indigo-500">
                                                {' '}
                                                View all products <span aria-hidden="true">&rarr;</span>
                                            </a>
                                        </div>
                                    </nav>
                                </div>
                            </div>
                            <div className="py-6 px-5">
                                {/*<div className="grid grid-cols-2 gap-4">*/}
                                {/*    <a href="#"*/}
                                {/*       className="rounded-md text-base font-medium text-gray-900 hover:text-gray-700">*/}
                                {/*        Pricing*/}
                                {/*    </a>*/}

                                {/*    <a href="#"*/}
                                {/*       className="rounded-md text-base font-medium text-gray-900 hover:text-gray-700">*/}
                                {/*        Docs*/}
                                {/*    </a>*/}

                                {/*    <a href="#"*/}
                                {/*       className="rounded-md text-base font-medium text-gray-900 hover:text-gray-700">*/}
                                {/*        Company*/}
                                {/*    </a>*/}

                                {/*    <a href="#"*/}
                                {/*       className="rounded-md text-base font-medium text-gray-900 hover:text-gray-700">*/}
                                {/*        Resources*/}
                                {/*    </a>*/}

                                {/*    <a href="#"*/}
                                {/*       className="rounded-md text-base font-medium text-gray-900 hover:text-gray-700">*/}
                                {/*        Blog*/}
                                {/*    </a>*/}

                                {/*    <a href="#"*/}
                                {/*       className="rounded-md text-base font-medium text-gray-900 hover:text-gray-700">*/}
                                {/*        Contact Sales*/}
                                {/*    </a>*/}
                                {/*</div>*/}
                                <div className="mt-6">
                                    {isAuthenticated ? <Link
                                            to="/dashboard"
                                            className="w-full flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-indigo-600 hover:bg-indigo-700"
                                        >
                                            Sign up
                                        </Link> :
                                        <Link
                                            to="/signup"
                                            className="ml-8 inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-base font-medium text-black"
                                        >
                                            Sign up
                                        </Link>}


                                    <p className="mt-6 text-center text-base font-medium text-gray-500">
                                        Do you have an account ?{' '}


                                        <Link to="/login" className="text-indigo-600 hover:text-indigo-500">
                                            Sign in
                                        </Link>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </Popover.Panel>
                </Transition>
            </Popover>
            <Alert/>
        </>
    )
}

const mapStateToProps = state => ({
    isAuthenticated: state.Auth.isAuthenticated,
    user: state.Auth.user,
    categories: state.Categories.categories,
    total_items: state.Cart.total_items,
    profile: state.Profile.profile
})

export default connect(mapStateToProps, {
    logout,
    get_categories,
    get_search_products,
})(Navbar)